---
import Button from "../ui/button.astro";
import Sidebar from "./sidebar.jsx";

const { data } = Astro.props;
---

<div id="scroll-trigger" class="h-[1px]"></div>

<header
  id="site-header"
  class="sticky top-0 z-50 transition-all duration-300 ease-out"
>
  <nav
    class="container mx-auto flex justify-between items-center py-3 px-4 md:px-6 lg:px-8"
  >
    {/* Logo Area */}
    <div>
      <a href="/">
        <h1 class="text-2xl font-bold font-outfit tracking-wide text-gray-900">
          {data?.logo?.title ? data.logo.title : "Add Logo"}<span
          class="text-4xl font-bold font-outfit text-gray-900">.</span
          >
        </h1>
      </a>
    </div>

    {/* Desktop Nav */}
    <ul
      id="nav-list"
      class="hidden md:flex gap-x-9 py-2.5 px-5.5 rounded-full"
    >
      {
        data?.navLinks &&
          data.navLinks?.map((navLink: any) => {
            return (
              <li>
                <a
                  href={navLink.href}
                  class="inline-block text-sm text-gray-800 hover:text-black font-medium font-ovo tracking-wide hover:-translate-y-[2px] transition-all duration-200 cursor-pointer"
                >
                  {navLink.title}
                </a>
              </li>
            );
          })
      }
    </ul>

    {/* CHANGE 2: Wrapped Button and Sidebar in a div for proper spacing */}
    <div class="flex items-center gap-4">
      
      {/* Added hidden sm:block so button doesn't cramp mobile screen */}
      <div class="hidden md:block">
        <Button
            title={data?.callToAction?.title}
            bgColor={data?.callToAction?.ctaTheme}
            textColor={data?.callToAction?.textColor}
            iconName={data?.callToAction?.iconName}
            href={data?.callToAction?.href}
        />
      </div>

      <Sidebar client:idle />
    </div>
  </nav>
</header>

<script>
  const header = document.getElementById("site-header");
  const navList = document.getElementById("nav-list");
  const trigger = document.getElementById("scroll-trigger");

  const observer = new IntersectionObserver(
    ([entry]) => {
      if (!entry.isIntersecting) {
        header?.classList.add("bg-white/95", "shadow-sm");
        navList?.classList.remove("bg-white", "shadow-sm");
      } else {
        header?.classList.remove("bg-white/95", "shadow-sm");
        navList?.classList.add("bg-white", "shadow-sm");
      }
    },
    {
      root: null,
      threshold: 0,
    }
  );

  // CHANGE 3: Added safety check
  if (trigger) {
    observer.observe(trigger);
  }
</script>
---
import Layout from "../layouts/Layout.astro";
import BlockRenderer from "../components/layout/blockRenderer.astro";
const API_URL = import.meta.env.PUBLIC_STRAPI_URL;

const URL =
  `${API_URL}/api/home-page?populate[blocks][on][sections.hero][populate][ProfilePicture][fields][0]=url&populate[blocks][on][sections.hero][populate][heroCta][populate]=*&populate[blocks][on][sections.intro][populate][aboutPic][fields][0]=url&populate[blocks][on][sections.intro][populate][aboutCard][populate][serviceLink][populate]=*&populate[blocks][on][sections.services][populate][serviceCard][populate][serviceLink][populate]=*&populate[blocks][on][sections.skills][populate][skillComponent][populate][skillBar][populate]=*&populate[blocks][on][sections.projects][populate][projectCard][populate][link][populate]=*&populate[blocks][on][sections.projects][populate][projectCard][populate][projectPic][fields][0]=url&populate[blocks][on][sections.projects][populate][projectCta][populate]=*&populate[blocks][on][sections.blogs][populate][blogCard][populate][blogPic][fields][0]=url&populate[blocks][on][sections.blogs][populate][blogCta][populate]=*&populate[blocks][on][sections.contact][populate][socialContact][populate]=*`;

async function loadData() {
  try {
    const request = await fetch(URL);
    const response = await request.json();

    if (!request.ok) {
      throw new Error("Server is down");
    }
    return response?.data || null;
  } catch (error) {
    console.error(error);
    return null;
  }
}

const landingPage = await loadData();
const blocks = landingPage?.blocks || [];
---

<Layout>
  {blocks.map((block: any) => <BlockRenderer block={block} />)}
</Layout>
